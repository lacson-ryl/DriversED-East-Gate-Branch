<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Driver's Ed Certificate</title>
  <% if (isPDF) { %>
    <style>
      <%=tailwindCSS %>
    </style>
    <% } else { %>
      <link rel="stylesheet" href="/account/f-css/output.css" />
      <% } %>

        <script type="module">
          import Dexie from "https://cdn.jsdelivr.net/npm/dexie@3.2.4/dist/dexie.mjs";
          window.Dexie = Dexie;
        </script>
        <style>
          @media print {
            @page {
              size: landscape;
              margin: 0;
            }

            body {
              width: 100%;
              height: 100%;
              font-family: 'Roboto', sans-serif;
            }
          }
        </style>
</head>

<body class="bg-gray-100">
  <div class="fixed">
    <div class="flex flex-col items-start gap-3 mx-10 pt-5 text-xs">
      <button id="save-to-pdf" btn-type="pdf" class="hover:underline underline-offset-1 hide-on-print ">
        Save to PDF</button>
      <button id="save-to-database" btn-type="database" class="hover:underline underline-offset-1 hide-on-print">
        Save to Database</button>
    </div>
  </div>
  <div class="flex items-center justify-center min-h-screen bg-white">
    <div
      class="w-[1000px] h-[700px] relative bg-white border-b-8 border-b-red-700 shadow-xl flex flex-col justify-between">

      <!-- Wavy Orange Background (Flipped Downward) -->
      <div class="absolute top-0 left-0 w-full h-36 overflow-hidden z-0">
        <svg class="w-full h-full transform scale-y-[-1] opacity-70" viewBox="0 0 1000 100" preserveAspectRatio="none">
          <path d="M0,0 C200,60 800,20 1000,0 L1000,100 L0,100 Z" fill="#f97316" />
          <path d="M0,0 C500,60 500,40 500,50 L100,40 L0,20 Z" fill="#f93b16" />
          <path d="M0,0 C200,60 800,40 1000,100 L1000,40 L0,20 Z" fill="#f93b16" />
        </svg>
      </div>

      <!-- Header (on top of wave) -->
      <div class="flex flex-row z-10 text-center gap-5 px-10 pt-3">
        <div>
          <img id="driversEdLogo" src="" class="w-44 h-28" alt="">
        </div>
        <div class="flex flex-col">
          <h1 class="text-5xl font-black font-mono text-red-700">DRIVER'S ED <span class="font-normal">Driving
              School</span></h1>
          <p class="text-base font-medium mt-1">3rd Floor, U Five Building, Dolores City of San Fernando, Pampanga</p>
          <p class="text-base font-medium">Mobile No. 0917 326 4818</p>
        </div>
      </div>
      <p class="text-sm mt-1 px-10">Certificate No. <input class="font-semibold" type="text" name="certNumber"
          value="DEDS - 2020-00001-03"></p>

      <!-- Title -->
      <div class="text-center mt-4">
        <h2 class="text-5xl font-normal font-RobotoSerif tracking-[0.5em]">CERTIFICATION</h2>
      </div>

      <!-- Content -->
      <div class="text-lg text-center leading-relaxed px-18 mt-4">
        <p>
          This is to certify that
          <input id="name" name="name" type="text"
            class="border-b border-b-black font-bold text-center capitalize text-xl" data-autoresize
            oninput="this.style.width = (this.value.length + 3) + 'ch'" value="juan dela cruz">
          has completed <br>
          <input id="totalHours" name="totalHours" type="number"
            class="border-b border-b-black text-base font-bold text-center pl-2" data-autoresize
            oninput="this.style.width = (this.value.length + 3) + 'ch'" value="00"> hours
          <input id="drivingType" name="drivingType" type="text"
            class="border-b border-b-black text-base font-bold text-center"
            oninput="this.style.width = (this.value.length + 3) + 'ch'" data-autoresize value="Practical">
          Driving Course accredited by the
          Land Transportation Office (L.T.O.) <br> on
          <input id="dateStarted" name="dateStarted" type="text"
            class="border-b border-b-black text-base font-bold text-center " data-autoresize
            oninput="this.style.width = (this.value.length + 3) + 'ch'" value="October 14, 2025">
          up to
          <input id="dateEnded" name="dateEnded" type="text"
            class="border-b border-b-black text-base font-bold text-center "
            oninput="this.style.width = (this.value.length + 3) + 'ch'" data-autoresize value="October 25, 2025">,
          specifically
          for <br>
          <input id="courseType" name="courseType" type="text"
            class="border-b border-b-black font-bold text-center capitalize" data-autoresize
            oninput="this.style.width = (this.value.length + 3) + 'ch'" value="">
        </p>

        <p class="mt-4">
          This also certifies that the name above has shown efficiency and willingness to abide with the rules <br>
          and regulation of driving and has completed all necessary Lectures mandated by the
          <br>Land Transportation Office (L.T.O.).
        </p>

        <p class="mt-4">
          Given this
          <input id="day" name="day" type="text" class="border-b border-b-black font-bold text-center w-14"
            data-autoresize oninput="this.style.width = (this.value.length + 3) + 'ch'" value="25th"> day of
          <input id="monthYear" name="monthYear" type="text"
            class="border-b border-b-black font-bold text-center min-w-24" value="September 2025" data-autoresize
            oninput="this.style.width = (this.value.length + 3) + 'ch'"> at
          the City of San Fernando, Pampanga.
        </p>
      </div>

      <!-- Footer -->
      <div class="flex justify-between items-end px-20 mt-8">
        <div class="text-center">
          <input id="instructor" name="instructor" type="text"
            class="border-b-2 border-b-black font-bold text-center min-w-44" data-autoresize
            oninput="this.style.width = (this.value.length + 3) + 'ch'" value="Jose Mikko D. Benedicto">
          <p class="text-sm">Instructor</p>
          <input type="text" class="text-center min-w-44 bg-white" value="" disabled>
        </div>
        <div class="text-center">
          <input id="proprietor" name="proprietor" type="text"
            class="border-b-2 border-b-black font-bold text-center min-w-44" value="Michelle B. Pelaen, R.N.">
          <p class="text-sm">Proprietor</p>
          <input id="proprietorCode" name="proprietorCode" type="text" class="text-center min-w-44" value="Code here">
        </div>
      </div>
    </div>
  </div>

  <% if (isPDF) { %>
    <script>
      const data = <%- JSON.stringify(typeof payload !== 'undefined' ? payload : null) %>;
      console.log("data", data);

      async function populateCertificate(data) {
        const {
          certificateInputs,
          userCourse,
          userId,
          courseId,
          instructorId,
        } = data;
        const flatData = {
          ...certificateInputs[0],
          ...userCourse[0],
        };

        Object.entries(flatData).forEach(([key, value]) => {
          const input = document.querySelector(`[name="${key}"]`);
          if (input) input.value = value ?? "";
        });

        document.getElementById("driversEdLogo").src =
          certificateInputs[0].driversEdLogo;

        function autoResizeInput(input) {
          input.style.width = input.value.length + 3 + "ch";
        }
        document.querySelectorAll("input[data-autoresize]").forEach(autoResizeInput);

        const buttons = {
          savePdf: "save-to-pdf",
          saveDatabase: "save-to-database",
        };

        Object.values(buttons).forEach((buttonId) => {
          const btn = document.getElementById(buttonId);
          if (btn) {
            btn.setAttribute("data-user-id", userId);
            btn.setAttribute("data-course-id", courseId);
            btn.setAttribute("data-instructor-id", instructorId);
          }
        });
      }


      (async () => {
        if (data) {
          window.fetchedData = data;
          await populateCertificate(data);
          window.scriptLoaded = true;
        }
      })();
    </script>
    <% } else { %>
      <script type="module" src="/account/utils/f-webCryptoKeys.js"></script>
      <script type="module" src="/account/utils/f-keyManager.js"></script>
      <script type="module" src="/account/f-jsfiles/certificate-completion-PDC-TDC.js"></script>
      <% } %>

</body>

</html>